# XSS & CSRF

### XSS 공격

공격자(해커)가 클라이언트 브라우저에 스크립트를 삽입해 실행하는 공격이다.

- 공격자가 `<input>`을 통해 Javascript를 서버로 전송해 서버에서 스크립트를 실행하거나,
- `url`에 `Javascript`를 적어 클라이언트에서 스크립트 실행이 가능하다면 공격자가 사이트에 스크립트를 삽입해 `XSS` 공격을 할 수 있다.

이때 공격자는 스크립트를 통해 사이트의 글로벌 변수 값을 가져오거나 그 값을 이용해 사이트인 척 API 호출을 요청할 수도 있다. 다시 말하면 공격자의 코드가 내 사이트의 코드 인척 행동할 수 있다.

### CSRF 공격

공격자가 다른 사이트에서 우리 사이트의 API 호출을 요청해 실행하는 공격

- API 호출을 요청할 수 있는 클라이언트 도메인이 누구인지 서버에서 통제하고 있지 않을 때 가능.
- 공격자가 클라이언트에 저장된 `유저 인증 정보`를 서버에 보낼 수 있다면, 제대로 로그인한 것처럼 유저의 정보를 변경하거나 유저만 가능한 액션 들을 수행할 수 있다.
  - 예를 들어 `CSRF`에 취약한 은행 사이트가 있다면 로그인한 척 계좌 비밀번호를 바꾸거나 송금을 보낼 수 있다.

### **브라우저 저장소 종류와 보안 이슈**

1. `localStorage` 저장 방식

브라우저 저장소에 저장하는 방식이다. JS 에서 **글로벌 변수**로 **읽기 / 쓰기 접근이 가능**하다.

> 😡 `localStorage` 안에 `세션 id`, `refreshToken` 또는 `accessToken`을 저장해두면 `XSS` 취약점을 통해 그 안에 담긴 값을 불러오거나, 불러온 값을 이용해 API 호출을 위조할 수 있다.

1. 쿠기 저장 방식

브라우저에 쿠키로 저장되는데, 클라이언트가 HTTP 요청을 보낼 때마다 자동으로 쿠키가 서버에 전송된다. JS 에서 **글로벌 변수**로 **읽기 / 쓰기 접근이 가능**하다.

> 😡 쿠키 저장 방식 역시 안에 `세션 id`, `refreshToken`, `accessToken`을 저장해두면 `XSS` 취약점이 있을 때 담긴 값들을 불러오거나, API 호출을 보내면 쿠키에 담긴 값들이 함께 전송되어 로그인한 척 공격을 수행할 수 있다.

> 😡 쿠키에 `세션 id`나 `accessToken`을 저장해 인증에 이용하는 구조에 `CSRF` 취약점이 있다면 인증 정보가 쿠키에 담겨 서버로 보내진다. 공격자는 유저 권한으로 정보를 가져오거나 액션을 수행할 수 있다.

1. `secure` `httpOnly 쿠키` 저장 방식

브라우저에 쿠키로 저장되는 건 같지만, JS 내에서 **접근이 불가능**하다. `secure`을 적용하면 `https` 접속에서만 동작한다.

> 😀 `httpOnly` 쿠키 방식으로 저장된 정보는 `XSS` 취약점 공격으로 담긴 값을 불러올 수 없다.

> 😀 `httpOnly` 쿠키 역시 `refreshToken`만 저장하고 `accessToken`을 받아와 인증에 이용하는 구조로 `CSRF` 공격 방어가 가능하다.

> 😡 쿠키 저장 방식과 같은 이유로 `세션 id`, `accessToken`은 저장하면 안 된다.

> 😡 `httpOnly` 쿠키에 담긴 값에 접근할 수는 없지만 `XSS` 취약점을 노려 API 호출을 요청하면 `httpOnly` 쿠키에 담긴 값들도 함께 보내져 유저인 척 정보를 빼오거나 액션을 수행할 수 있다.

어떤 저장 방식을 택해도 `XSS` 취약점이 있다면 보안 이슈가 존재한다 그러므로 유저 정보 저장 방식을 바꾸는 것 만으로는 방어할 수 없고, 클라이언트와 서버에서 추가적으로 `XSS 방어 처리가 필수`다.

- `<input>`에서 입력된 값이 `html / Javascript`로 인식되지 않도록 `서버에서 escape 처리`를 해준다.
- `url`을 통해 `Javascript`를 수행할 수 없도록 `라우팅을 꼼꼼하게 관리`한다.
- `React`는 공격자가 string에 `html / Javascript`를 담아 `JSX`에 삽입할 경우 자동으로 escape 처리한다.
